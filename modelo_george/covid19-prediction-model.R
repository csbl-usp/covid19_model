# x <- seq(from = 0.01, to = 50, by = 0.01)

FunLoopSIR3RoSIR <- function(Si, Ii, gamma, Ro1, Ro2, Ro3, iquarant, durationq, x){
  S = c()
  I = c()
  R = c()
  beta1 <- Ro1*gamma;    beta2 <- Ro2*gamma; beta3 <- Ro3*gamma
  N <- length(x)
  S[1] <- Si;  I[1] <- Ii;  R[1] <- 1 - S[1] - I[1]
  for (i in 1:(N-1)){
    dt <- 10^-1
    S[i+1] <- S[i] -  beta1*S[i]*I[i]*dt
    I[i+1] <- 1 - S[i+1] - R[i]
    R[i+1] <- R[i] + gamma*I[i]*dt
    if (i  > iquarant*(1/0.01)) {
      S[i+1] <- S[i] -  beta2*S[i]*I[i]*dt
      I[i+1] <- 1 - S[i+1] - R[i]
      R[i+1] <- R[i] + gamma*I[i]*dt
    }
    if (i  > (iquarant+durationq)*(1/0.01)){
      S[i+1] <- S[i] -  beta3*S[i]*I[i]*dt
      I[i+1] <- 1 - S[i+1] - R[i]
      R[i+1] <- R[i] + gamma*I[i]*dt
    }
  }

  dataframe <- data.frame(col1=S, col2 = I, col3 = R)
  colnames(dataframe) = c("S","I","R")
  return(dataframe)
}

########### MODEL PARAMETERS GENERATED BY MATLAB SCRIPT ######################
parsItaly <- c(0.1001, 1.0882, 1.3197, 2.0000, 25.4713, 50.0000)
parsIran <- c(0.1001, 1.0841, 1.3151, 2.0000, 25.4713, 50.0000)
parsHubei <- c(0.4135, 1.1003, 0.5005, 2.0000, 25.4655, 50.0000)
parsKorea <- c(0.1000, 1.2552, 1.0990, 2.0000, 25.4710, 50.0000)

locations <- c("pars1","pars2","pars3","pars4","pars5","pars6")
locDF <- data.frame(parsItaly, parsHubei, parsKorea, parsIran)
rownames(locDF) <- locations

##############Setting time-range ---- 
x <- seq(from = 0.01, to = 120, by = 0.01)

##############Values to change with the user input
TotalPop <- as.numeric(10^7)
InitCases <- as.numeric(100)
Si <- (TotalPop-InitCases)/TotalPop
Ii <- InitCases/TotalPop
pars <- locDF[, as.numeric(1)]

###############Apply Differential equation
SIR = FunLoopSIR3RoSIR(Si, Ii, pars[1], pars[2], pars[3], pars[4], pars[5], pars[6], x)


################Plots Area!
library(plotly)

######Rplot_50dias
figure1 <- plot_ly(SIR, x = ~x[1:5000], y = ~I[1:5000]*1000, name = 'Infected', mode = 'lines', type = 'scatter', line = list(color = 'rgb(77, 77, 255)', width = 4))
figure1 <- figure1 %>% layout(title = "São Paulo de acordo com Itália",
                            xaxis = list(title = "Dias desde o início da contagem"),
                            yaxis = list(side = 'left', title = 'Cumulativo dos casos (R% população)', showgrid = FALSE, zeroline = FALSE))
figure1

######Rplot_120dias
figure2 <- plot_ly(SIR, x = ~x, y = ~I*1000, name = 'Infected', mode = 'lines', type = 'scatter', line = list(color = 'rgb(255, 77, 77)', width = 4))
figure2 <- figure2 %>% add_trace(y = ~R*3.5, name = 'Recovered', line = list(color = 'rgb(77, 77, 255)', width = 4), yaxis = 'y2')
figure2 <- figure2 %>% layout(title = "São Paulo de acordo com Itália",
                            xaxis = list(title = "% Dias desde o início da contagem"),
                            yaxis = list(side = 'left', title = 'Cumulativo dos casos (R% população)', showgrid = FALSE, zeroline = FALSE),
                            yaxis2 = list(side = 'right', overlaying = "y", title = '%População Doente Simultaneamente', showgrid = FALSE, zeroline = FALSE))
figure2

